(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-338220b6"],{"1fdf":function(e,t,a){"use strict";a("6c34")},"51a2":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ticket-container"},[a("div",{staticClass:"ticket-header"},[a("a-button",{directives:[{name:"wave",rawName:"v-wave"}],attrs:{type:"primary"},on:{click:function(t){return e.onAdd()}}},[a("svg-icon",{attrs:{name:"plus"}}),e._v(" 新建工单 ")],1)],1),e.ticketData?a("a-table",{staticClass:"ticket-table data-table use-shadow",attrs:{"data-source":e.ticketData,pagination:!1,"row-key":"id","table-layout":"fixed",scroll:{x:!0}}},[a("a-table-column",{key:"index",attrs:{"data-index":"index",title:"#",width:"80px"}}),a("a-table-column",{key:"subject",attrs:{"data-index":"subject",title:"主题",width:"280px"}}),a("a-table-column",{key:"levelLabel",attrs:{"data-index":"levelLabel",title:"工单级别",width:"120px"}}),a("a-table-column",{key:"statusLabel",attrs:{"data-index":"statusLabel",title:"工单状态",width:"120px"},scopedSlots:e._u([{key:"customRender",fn:function(t,n){return a("div",{},[a("a-badge",{attrs:{status:n.status===e.States.HANDLING?"error":"processing"}}),e._v(" "+e._s(t)+" ")],1)}}],null,!1,2346779520)}),a("a-table-column",{key:"created_at",attrs:{"data-index":"created_at",title:"创建时间",width:"200px"},scopedSlots:e._u([{key:"customRender",fn:function(t){return a("div",{},[e._v(" "+e._s(e._f("datetime")(t))+" ")])}}],null,!1,1867572093)}),a("a-table-column",{key:"updated_at",attrs:{"data-index":"updated_at",title:"最后回复",width:"200px"},scopedSlots:e._u([{key:"customRender",fn:function(t){return a("div",{},[e._v(" "+e._s(e._f("datetime")(t))+" ")])}}],null,!1,1867572093)}),a("a-table-column",{attrs:{title:"操作",align:"center",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t,n){return[a("span",[a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.onView(n)}}},[e._v("查看")]),a("a-button",{attrs:{disabled:n.status===e.States.CLOSED,type:"link"},on:{click:function(t){return e.onClose(n)}}},[e._v("关闭")])],1)]}}],null,!1,2497431355)})],1):a("div",{staticClass:"spin-loading"},[a("a-spin",{attrs:{size:"large"}})],1),a("ticket-modal",{ref:"refModal",on:{change:e.getTicketData}}),a("ticket-chat",{ref:"refChat"})],1)},s=[],r=a("c7eb"),i=a("5530"),l=a("1da1"),c=(a("d81d"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:"新建工单","confirm-loading":e.loading,"after-close":e.onClosed},on:{ok:e.onSubmit},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("a-spin",{attrs:{spinning:e.loading}},[a("a-form-model",{ref:"refForm",attrs:{model:e.formModel,rules:e.formRules},on:{submit:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[a("a-form-model-item",{attrs:{label:"主题",prop:"subject"}},[a("a-input",{attrs:{size:"large","max-length":64,placeholder:"请输入工单问题","allow-clear":""},model:{value:e.formModel.subject,callback:function(t){e.$set(e.formModel,"subject",t)},expression:"formModel.subject"}})],1),a("a-form-model-item",{attrs:{label:"工单等级",prop:"level"}},[a("a-select",{attrs:{size:"large",placeholder:"请选择工单等级"},model:{value:e.formModel.level,callback:function(t){e.$set(e.formModel,"level",t)},expression:"formModel.level"}},e._l(e.Levels.toArray(),(function(t){return a("a-select-option",{key:t.value,attrs:{value:t.value}},[e._v(" "+e._s(t.label)+" ")])})),1)],1),a("a-form-model-item",{attrs:{label:"消息",prop:"message"}},[a("a-input",{attrs:{type:"textarea",size:"large","max-length":256,rows:4,placeholder:"请描述你遇到的问题","allow-clear":""},model:{value:e.formModel.message,callback:function(t){e.$set(e.formModel,"message",t)},expression:"formModel.message"}})],1)],1)],1)],1)}),o=[],u=a("77fe"),d=new u["a"]({LOW:[0,"低"],NORMAL:[1,"中"],HIGH:[2,"高"]}),f=new u["a"]({HANDLING:[0,"待回复"],CLOSED:[1,"已关闭"]}),m=a("54d7"),v=a("8c8a");function p(){return Object(v["a"])({url:m["g"]+"/api/v1/user/ticket/fetch",method:"get"})}function b(e){return Object(v["a"])({url:m["g"]+"/api/v1/user/ticket/fetch?id=".concat(e),method:"get"})}function h(e){return Object(v["a"])({url:m["g"]+"/api/v1/user/ticket/save",method:"post",params:e})}function g(e){return Object(v["a"])({url:m["g"]+"/api/v1/user/ticket/close?id=".concat(e),method:"post"})}function k(e){return Object(v["a"])({url:m["g"]+"/api/v1/user/ticket/reply",method:"post",params:e})}var w={name:"TicketModal",data:function(){return{visible:!1,loading:!1,formModel:{subject:"",level:d.LOW,message:""},formRules:{subject:[{required:!0,message:"请输入工单问题",trigger:"blur"}],level:[{required:!0,message:"请选择工单等级",trigger:"change"}],message:[{required:!0,message:"请描述你遇到的问题",trigger:"blur"}]},Levels:d}},methods:{showModal:function(e){var t=this;return Object(l["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.visible=!0;case 1:case"end":return e.stop()}}),e)})))()},onSubmit:function(){var e=this,t=this.formModel,a=t.subject,n=t.level,s=t.message;this.$refs.refForm.validate(function(){var t=Object(l["a"])(Object(r["a"])().mark((function t(i){var l;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!i){t.next=14;break}return e.loading=!0,t.prev=2,t.next=5,h({subject:a,level:n,message:s});case 5:l=t.sent,!0===l.data&&(e.$message.success("工单已提交"),e.visible=!1,e.$emit("change")),t.next=11;break;case 9:t.prev=9,t.t0=t["catch"](2);case 11:e.loading=!1,t.next=15;break;case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,null,[[2,9]])})));return function(e){return t.apply(this,arguments)}}())},onClosed:function(){console.log(222),this.formModel.message="",this.formModel.subject="",this.formModel.level=d.LOW}}},y=w,x=a("2877"),_=Object(x["a"])(y,c,o,!1,null,null,null),C=_.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:"工单回复",width:800,"after-close":e.onClosed,footer:!1},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("form",{staticClass:"ticket-chat",on:{submit:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[a("div",{staticClass:"chat-tip"},[e._v(e._s(e.replyCount)+"个回复")]),a("a-divider",{staticClass:"chat-line"}),e.messages?a("div",{staticClass:"chat-items"},[e.messages.length>0?e._l(e.messages,(function(t){return a("div",{key:t.id,staticClass:"chat-item"},[t.is_me?[a("div",{staticClass:"right",staticStyle:{"text-align":"right","margin-right":"20px"}},[a("span",{staticClass:"time"},[e._v(e._s(e._f("datetime")(t.updated_at)))]),a("span",{staticClass:"name"},[e._v("You")]),a("p",{staticClass:"content"},[e._v(e._s(t.message))])]),a("a-avatar",{staticClass:"avatar"},[e._v("U")])]:[a("a-avatar",{staticClass:"avatar"},[a("svg-icon",{attrs:{name:"user"}})],1),a("div",{staticClass:"right",staticStyle:{"text-align":"left","margin-left":"20px"}},[a("span",{staticClass:"name"},[e._v("Administrator")]),a("span",{staticClass:"time"},[e._v(e._s(e._f("datetime")(t.updated_at)))]),a("p",{staticClass:"content"},[e._v(e._s(t.message))])])]],2)})):e._e()],2):a("div",{staticClass:"spin-loading"},[a("a-spin",{attrs:{size:"large"}})],1),a("div",{staticClass:"chat-reply"},[a("a-avatar",{staticClass:"avatar"},[e._v("U")]),a("a-input",{staticClass:"input",attrs:{type:"textarea",size:"large","max-length":256,rows:4,placeholder:"请描述你遇到的问题","allow-clear":""},model:{value:e.replyContent,callback:function(t){e.replyContent=t},expression:"replyContent"}})],1),a("div",{staticClass:"chat-button"},[a("button",{directives:[{name:"wave",rawName:"v-wave"}],staticClass:"n-button color-1",attrs:{type:"submit"}},[a("svg-icon",{attrs:{name:"pencil-simple-line"}}),e._v(" 回复 ")],1)])],1)])},O=[],M=(a("4de4"),a("d3b7"),{name:"Chat",data:function(){return{rowId:"",visible:!1,messages:null,replyContent:"",replyCount:0}},methods:{showModal:function(e){this.visible=!0,this.rowId=e.id,this.getMessages()},getMessages:function(){var e=this,t=function(){var t=Object(l["a"])(Object(r["a"])().mark((function t(){var a,n;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,b(e.rowId);case 2:n=t.sent,e.messages=null!==(a=n.data.message)&&void 0!==a?a:[],e.replyCount=e.messages.filter((function(e){return!e.is_me})).length;case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t(),clearInterval(this.timer),this.timer=setInterval((function(){t()}),1e4)},onSubmit:function(){var e=this;return Object(l["a"])(Object(r["a"])().mark((function t(){var a;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.replyContent){t.next=2;break}return t.abrupt("return",e.$message.warning("请输入内容"));case 2:return t.next=4,k({id:e.rowId,message:e.replyContent});case 4:a=t.sent,!0===a.data&&(e.$message.success("回复成功"),e.getMessages());case 6:case"end":return t.stop()}}),t)})))()},onClosed:function(){this.messages=[],this.replyContent="",this.replyCount=0,clearInterval(this.timer)}}}),L=M,S=(a("1fdf"),Object(x["a"])(L,j,O,!1,null,"95c709e4",null)),D=S.exports,$={name:"Ticket",components:{TicketModal:C,TicketChat:D},data:function(){return{ticketData:null,States:f,Levels:d}},mounted:function(){this.getTicketData()},methods:{getTicketData:function(){var e=this;return Object(l["a"])(Object(r["a"])().mark((function t(){var a,n;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p();case 2:n=t.sent,e.ticketData=(null!==(a=n.data)&&void 0!==a?a:[]).map((function(e,t){return Object(i["a"])(Object(i["a"])({},e),{},{index:t+1,levelLabel:d.getLabel(e.level),statusLabel:f.getLabel(e.status)})}));case 4:case"end":return t.stop()}}),t)})))()},onAdd:function(){this.$refs.refModal.showModal()},onView:function(e){this.$refs.refChat.showModal(e)},onClose:function(e){var t=this;this.$confirm({title:"注意",content:"确定要关闭该工单吗？",onOk:function(){var a=Object(l["a"])(Object(r["a"])().mark((function a(){var n;return Object(r["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,g(e.id);case 2:n=a.sent,!0===n.data&&(t.$message.success("工单已关闭"),t.getTicketData());case 4:case"end":return a.stop()}}),a)})));function n(){return a.apply(this,arguments)}return n}()})}}},I=$,A=(a("cddd"),Object(x["a"])(I,n,s,!1,null,"1aebe8fd",null));t["default"]=A.exports},"6c34":function(e,t,a){},"77fe":function(e,t,a){"use strict";var n=a("d4ec"),s=a("bee2"),r=(a("d3b7"),a("159b"),a("b64b"),a("d81d"),a("7db0"),function(){function e(t){Object(n["a"])(this,e),this.defination=t,this.parseDefination()}return Object(s["a"])(e,[{key:"parseDefination",value:function(){var e=this;Object.keys(this.defination).forEach((function(t){e[t]=e.defination[t][0]}))}},{key:"toArray",value:function(){var e=this,t=Object.keys(this.defination).map((function(t){var a=e.defination[t];return{value:a[0],label:a[1]}}));return t}},{key:"getLabel",value:function(e){var t,a;return null!==(t=null===(a=this.toArray().find((function(t){return String(t.value)===String(e)})))||void 0===a?void 0:a.label)&&void 0!==t?t:""}}]),e}());t["a"]=r},8770:function(e,t,a){},bee2:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a("a38e");function s(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,Object(n["a"])(s.key),s)}}function r(e,t,a){return t&&s(e.prototype,t),a&&s(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}},cddd:function(e,t,a){"use strict";a("8770")},d4ec:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));a("d9e2");function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}}}]);